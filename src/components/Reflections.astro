---
import { supabase } from "../db/supabase";

const { data, error } = await supabase
  .from("reflection_items")
  .select("id, category, title, front_text, back_text, tone")
  .eq("is_published", true)
  .order("sort_order", { ascending: true });

const reflectionItems = data ?? [];

const toneClasses: Record<string, string> = {
  primary: "bg-primary/90 text-white",
  secondary: "bg-secondary/90 text-white",
  accent: "bg-accent/90 text-text-main",
};

const getToneClass = (tone?: string) => toneClasses[tone ?? ""] ?? toneClasses.primary;

if (error) {
  console.error("Supabase reflection_items error:", error);
}
---

<section id="reflexiones" class="py-16">
  <div class="mx-auto max-w-7xl px-6">
    <div class="text-center">
      <p class="text-xs font-semibold uppercase tracking-[0.3em] text-secondary">Reflexiones</p>
      <h2 class="font-display text-3xl text-text-main sm:text-4xl">Pequeños textos para el alma</h2>
      <p class="mt-4 text-sm text-slate-600">Mensajes breves que invitan a la calma y la transformación interior.</p>
    </div>
    <div class="mt-12 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {reflectionItems.map((item) => (
        <article class="group relative rounded-3xl bg-white p-6 shadow-sm transition [transform-style:preserve-3d] hover:[transform:rotateY(180deg)]">
          <div class="space-y-4 [backface-visibility:hidden]">
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-primary">{item.category}</p>
            <h3 class="text-lg font-semibold">{item.title}</h3>
            <p class="text-sm text-slate-600">{item.front_text}</p>
          </div>
          <div
            class={`absolute inset-0 flex items-center justify-center rounded-3xl p-6 text-center [backface-visibility:hidden] [transform:rotateY(180deg)] ${getToneClass(
              item.tone
            )}`}
          >
            <p class="text-sm">{item.back_text}</p>
          </div>
        </article>
      ))}
    </div>
  </div>
</section>
